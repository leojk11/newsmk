<!DOCTYPE html>
<html>
<head>
	<base href="/">
	<meta charset="utf-8">
	<title>Admin | Posts</title>
	<link href="https://fonts.googleapis.com/css?family=Montserrat:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">
	<link rel="stylesheet" href="admin/css">

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

	<script src="admin-js/edit-cat-popup"></script>
	<script src="admin-js/edit-user-popup"></script>
	<script src="admin-js/logged-in-admin-info"></script>
	<script src="admin-js/logout"></script>
</head>
<body>
	<div class="page-mask"></div><!--page mask-->

	<div id="category-popup" class="popup">
		<div class="popup-wrapper">
			<div class="popup-input">
				<input id="category" class="new-post-input" type="text" style="width: 100%;" placeholder="Enter category name">
			</div><!-- popup input -->
			<br>
			<div id="edit-cat" class="save-btn" style="margin: 0 auto;"><img src="admin/edit-svg" style="margin-left: 80px"><span style="margin-left: 8px;">Edit</span></div>
		</div>
		<br>
		<div class="cat-error-div">
			<div class="error">Category does not exist</div>
		</div> <!-- error div -->
	</div>

	<div id="users-popup" class="popup">
		<div class="popup-wrapper">
			<div class="popup-input">
				<input id="user-id" class="new-post-input" type="text" style="width: 100%;" placeholder="Enter user ID">
			</div><!-- popup input -->
			<br>
			<div id="edit-user-loc" class="save-btn" style="margin: 0 auto;"><img src="admin/edit-svg" style="margin-left: 80px"><span style="margin-left: 8px;">Edit</span></div>
		</div>
		<br>
		<div class="cat-error-div">
			<div class="error">Category does not exist</div>
		</div> <!-- error div -->
	</div>

	<div class="left-menu">
		<div class="left-menu-title">newsMK Admin</div>
		<div class="logged-in-admin">
			<div class="admin-image">
				<img id="admin-img" alt="">
			</div> <!-- admin image -->

			<div class="admin-name-wrapper">
				<div class="admin-name"></div>
				<div class="admin-status"><span class="indicator indicator-color"></span><span class="online-status"></span></div>
			</div> <!-- admin name wrapper -->
		</div><!-- logged in admin -->
		<br>

		<a href="admin/dashboard"><div class="menu-item"><img src="admin/home-icon" width="50"><div class="menu-item-text">Home</div></div></a>

		<div class="label">Users</div>
		<a href="admin/users"><div class="menu-item"><img src="admin/user-icon" style="filter: invert(100%);"><div class="menu-item-text">Users</div></div></a>
		<a href="admin/new-user"><div class="menu-item"><img src="admin/add-new-icon" style="filter: invert(100%);"><div class="menu-item-text">Add new user</div></div></a>
		<a id="edit-user"><div class="menu-item"><img src="admin/edit-svg" style="filter: invert(100%);"><div class="menu-item-text">Edit user</div></div></a>

		<div class="label">Posts</div>
		<a href="admin/posts"><div class="menu-item active-menu-item"><img src="admin/calendar-icon" style="filter: invert(100%);"><div class="menu-item-text">Manage posts</div></div></a>
		<a href="admin/new-post"><div class="menu-item"><img src="admin/add-new-icon" style="filter: invert(100%);"><div class="menu-item-text">Add new post</div></div></a>

		<div class="label">Slider posts</div>
		<a href="admin/slider-post"><div class="menu-item"><img src="admin/calendar-icon" style="filter: invert(100%);"><div class="menu-item-text">Manage slider posts</div></div></a>
		<a href="admin/add-slider-post"><div class="menu-item"><img src="admin/add-new-icon" style="filter: invert(100%);"><div class="menu-item-text">Add new slider post</div></div></a>

		<div class="label">Post categories</div>
		<a href="admin/categories"><div class="menu-item"><img src="admin/cubes-icon" style="filter: invert(100%);"><div class="menu-item-text">Categories</div></div></a>
		<a href="admin/new-category"><div class="menu-item"><img src="admin/add-new-icon" style="filter: invert(100%);"><div class="menu-item-text">Add new category</div></div></a>
		<a id="edit-category"><div class="menu-item"><img src="admin/edit-svg" style="filter: invert(100%);"><div class="menu-item-text">Edit category</div></div></a>
		<div class="add-new-admin-func"></div> <!-- head admin options -->
		<br>
		<a id="logout-btn"><div class="menu-item"><img src="admin/login-icon"><div class="menu-item-text">Logout</div></div></a>
	</div> <!--left menu-->

	<script type="text/javascript">
		$(document).ready(function(){
			$('.page-mask').click(function(event){
				event.preventDefault();

				$('.page-mask').fadeOut('fast');
				$('#category-popup').fadeOut('fast');
				$('#users-popup').fadeOut('fast');
			})
		})
	</script>

	<div class="right">
		<div class="right-wrapper">
			<div class="dashboard-title">Manage posts</div><br>

			<div class="todays-results" style="width: 700px">
				<label>Today's results</label>
				<div class="boxes" style="justify-content: space-between; margin-top: 20px; width: 1000px;">
					<div id="today-users" class="dashboard-box today-users" style="width: 470px;">
						<div class="box-title today-users-title">Today's Posts</div>
						<div id="today-users-numb" class="box-number today-users-number-label"></div>
					</div>

					<div id="overall-users" class="dashboard-box today-users overall-users-box" style="width: 470px;">
						<div class="box-title overall-users-label">Overall posts</div>
						<div id="overall-users-numb" class="box-number"></div>
					</div>
				</div> <!-- boxes -->
			</div> <!-- todays results -->

			<div class="search">
				<input class="search" type="text" name="Posts" placeholder="Search posts..">
			</div> <!-- search -->

			<div class="all-posts"></div> <!-- all posts -->
			
		</div> <!-- right wrapper-->
	</div> <!--right-->

	<script type="text/javascript">
		$(document).ready(function(){
			$.ajax({
				url: 'admins/posts',
				success: function(data){
					console.log(data)
					const posts = data.posts;

					showPosts(posts);

					const todayPostsNumb = data.todayPostsNumb;
					$('#today-users-numb').append(todayPostsNumb);

					$('#today-users').click(function(event){
						event.preventDefault();

						$('.all-posts').html('');

						const todayPosts = data.todayPosts;
						showPosts(todayPosts);
					})

					const overallPostsNumb = data.overallPostsNumb;
					$('#overall-users-numb').append(overallPostsNumb);

					$('#overall-users').click(function(event){
						event.preventDefault();

						$('.all-posts').html('');

						const overallPosts = data.posts;
						showPosts(overallPosts);
					})

					$('.delete-wrapper').click(function(event){
						const postId = this.id;
						console.log(postId);

						$.ajax({
							url: 'admins/delete-post?postId=' + postId,
							method: 'delete',
							success: function(data){
								console.log(data);
								if(data.message == 'post deleted'){
									location.reload();
								}
							}, error: function(data){
								console.log(data);
							}
						})
					})
				}, error: function(error){
					console.log(error);
				}
			})

			showPosts = (posts) => {
				var i = 0;
				while(i < posts.length){
					const postWrapper = $('<div>').addClass('post-wrapper');
						const imageWrapper = $('<div>').addClass('post-image-wrapper');
							const postImage = $('<img>').attr({ 'src':'admin/post-image?image=' + posts[i].image });
						imageWrapper.append(postImage);
					postWrapper.append(imageWrapper);

						const otherInfo = $('<div>').addClass('post-other-info');
							const postTitle = $('<div>').addClass('post-title');
								const titleLabel = $('<b>').append(posts[i].title);
							postTitle.append(titleLabel);
						otherInfo.append(postTitle);
							const postDate = $('<div>').addClass('time-date-posted').append(posts[i].date_posted).css({ 'color':'#505050' });
						otherInfo.append(postDate);
							const writer = $('<div>').addClass('who-posted');
								const writerLabel = $('<b>').append('Писател: ');
							writer.append(writerLabel);
							writer.append(posts[i].writer);
						otherInfo.append(writer);
					postWrapper.append(otherInfo);

						const category = $('<div>').addClass('post-category');
							const catLabel = $('<div>').addClass('cat-title-posts').append('Категорија');
							const catName = $('<div>').addClass('cat-name').append(posts[i].category);
						category.append(catLabel);
						category.append(catName);
					postWrapper.append(category);

						const buttons = $('<div>').addClass('buttons');
							const editBtnLink = $('<a>').attr({ 'href':'admin/edit-post?postId=' + posts[i].ID });
								const editBtnWrapper = $('<div>').addClass('edit-wrapper').attr({ 'id':posts[i].ID });
									const editIcon = $('<img>').attr({ 'src':'admin/edit-icon'});
								editBtnWrapper.append(editIcon);
							editBtnLink.append(editBtnWrapper);
						buttons.append(editBtnLink);
							const deleteBtnLink = $('<a>');
								const deleteBtnWrapper = $('<div>').addClass('delete-wrapper').attr({ 'id':posts[i].ID });
									const binIcon = $('<img>').attr({ 'src':'admin/delete-icon'});
								deleteBtnWrapper.append(binIcon);
							deleteBtnLink.append(deleteBtnWrapper);
						buttons.append(deleteBtnLink);
					postWrapper.append(buttons);

					$('.all-posts').append(postWrapper);
					i++;
				}
			}
		})
	</script>
</body>
</html>