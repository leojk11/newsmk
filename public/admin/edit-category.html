<!DOCTYPE html>
<html>
<head>
	<base href="/">
	<meta charset="utf-8">
	<title>Admin | Edit category</title>
	<link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="admin/css">

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
</head>
<body>
	<div class="left-menu">
		<div class="left-menu-title">newsMK Admin</div>

		<a href="admin/dashboard"><div class="menu-item"><img src="admin/home-icon"><div class="menu-item-text">Home</div></div></a>

		<div class="label">Live activity</div>
		<a href="admin/users"><div class="menu-item"><img src="admin/user-icon" style="filter: invert(100%);"><div class="menu-item-text">Users</div></div></a>
		<a href="admin/new-user"><div class="menu-item"><img src="admin/add-new-icon" style="filter: invert(100%);"><div class="menu-item-text">Add new user</div></div></a>

		<div class="label">Posts</div>
		<a href="admin/posts"><div class="menu-item"><img src="admin/calendar-icon" style="filter: invert(100%);"><div class="menu-item-text">Manage posts</div></div></a>
		<a href="admin/new-post"><div class="menu-item"><img src="admin/add-new-icon" style="filter: invert(100%);"><div class="menu-item-text">Add new post</div></div></a>

		<div class="label">Post categories</div>
		<a href="admin/categories"><div class="menu-item"><img src="admin/cubes-icon" style="filter: invert(100%);"><div class="menu-item-text">Categories</div></div></a>
		<a href="admin/new-category"><div class="menu-item"><img src="admin/add-new-icon" style="filter: invert(100%);"><div class="menu-item-text">Add new category</div></div></a>
		<br>
		<a id="logout-btn"><div class="menu-item"><img src="admin/login-icon"><div class="menu-item-text">Logout</div></div></a>
	</div> <!--left menu-->

	<script type="text/javascript">
		$(document).ready(function(){
			$('#logout-btn').click(function(event){
				// console.log('leo');
				$.ajax({
					url: 'admins/logout',
					success: function(data){
						if(data.message == 'logged out'){
							location.href = 'admin';
						}
					}
				})
			})
		})
	</script>

	<div class="right">
		<div class="right-wrapper">
			<div class="dashboard-title">Edit category</div><br> <!-- dashboard title -->

			<div class="row">
				<input id="name" class="new-post-input" type="text" placeholder="Title">
			</div>
			<br>
			<br>
			<button class="save-btn"><img src="admin/add-new-icon" style="margin-left: 38px"><span>Add category</span></button>
		</div> <!-- right wrapper -->
    </div> <!-- right -->
    
    <script type="text/javascript">
        $(document).ready(function(){

            // get item from url
            var url = document.location.href,
                params = url.split('?')[1].split('&'),
                data = {}, tmp;
            for (var i = 0, l = params.length; i < l; i++) {
                tmp = params[i].split('=');
                data[tmp[0]] = tmp[1];
            }

            const catId = data.catId;

            $.ajax({
                url: 'admins/single-cat?catId=' + catId,
                success: function(data){
                    const category = data.category;
                    $('#name').val(category[0].name);
                }, error: function(error){
                    console.log(error);
                }
            })

            $('.save-btn').click(function(event){
                event.preventDefault();
                console.log('leo')

                const name = $('#name').val();

                $.ajax({
                    url: 'admins/edit-cat?catId=' + catId,
                    method: 'patch',
                    data: {
                        name: name
                    },
                    success: function(data){
                        // console.log(data);
                        if(data.message == 'cat edited'){
                            location.href = 'admin/categories';
                        }
                    }, error: function(error){
                        console.log(error);
                    }
                })
            })

            $('#name').keyup(function(event){
                if(event.keyCode == 13){
                    $('.save-btn').click();
                }
            })
        })
    </script>
</body>
</html>