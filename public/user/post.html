<!DOCTYPE html>
<html>
<head>
	<base href="/">
	<meta charset="utf-8">
	<title>single post</title>
	<link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="css">

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
</head>
<body onload="startTime()">
    <div class="page-mask"></div><!-- page mask -->
    <div class="login-form">
        <div class="login-form-title">Логирај се</div>
        <br>
        <div class="login-inputs">
            <div class="row">
                <input type="text" placeholder="Емаил">
            </div> <!-- row -->
            <div class="row">
                <input type="password" placeholder="Лозинка">
            </div> <!-- row -->
            
        </div><!-- login inputs -->

        <div class="button-wrapper">
            <div id="login-btn" class="button">ЛОГИРАЈ СЕ</div> <!-- button -->
            <div class="forget-pass">
                <a href=""><div class="forgotten-pass">Заборавена лозинка?</div><!-- forgotten pass --></a>
            </div><!-- forget pass -->
        </div><!-- button wrapper -->
    </div> <!-- login form -->
	<div class="header">
        <div class="header-wrapper">
            <div class="logo">
                newsMK
            </div> <!-- logo -->

            <div class="categories">
                <div id="all-cats" class="single-category">
                </div><!-- single category -->
            </div><!-- categories -->

            <script type="text/javascript">
                $(document).ready(function(){
                    $.ajax({
                        url: 'users/all-categories',
                        success: function(data){
                            // console.log(data);
                            const categories = data.categories;

                            var i = 0;
                            while(i < categories.length){
                                const category = $('<div>').addClass('cat-name').append(categories[i].name);
                                    $('.single-category').append(category);
                                i++;
                            }
                        }
                    })
                })
            </script>

            <div class="clock-wrapper">
                <div class="clock-icon">
                    <img src="client/clock-icon" alt="">
                </div> <!-- clock icon -->
                <div class="clock"></div><!-- clock -->
            </div>

            <div id="show-dropdown" class="user-menu">
                <div class="user-menu-icon"><img src="client/user-icon" alt=""></div>
                <div class="user-menu-down"><img src="client/down-arrow-icon" alt=""></div>
            </div> <!-- user menu -->

            <script type="text/javascript">
                $(document).ready(function(){
                    $('#show-dropdown').click(function(event){
                        event.preventDefault();

                        $('#dropdown-menu').slideToggle(500);
                    })
                })
            </script>
        </div><!-- header wrapper -->
    </div> <!-- header -->
    <div id="dropdown-menu" class="user-dropdown">
        <div class="dropdown-item">Регистрирај се</div>
        <div id="login-menu" class="dropdown-item"><img src="client/login-icon"><span>Логирај се</span></div>
    </div><!-- user dropdown -->

    <script type="text/javascript">
        $(document).ready(function(){
            $('#login-menu').click(function(event){
                console.log('leo')
                $('.page-mask').fadeIn('slow');
                $('.login-form').fadeIn('slow');
            });

            $('.page-mask').click(function(event){
                $('.page-mask').fadeOut('slow');
                $('.login-form').fadeOut('slow');
            })
        })
    </script>

    <div class="main">
        <div class="middle">
            <div class="category-small-post-title">
                <a class="category-post-title"></a> <!-- category post title -->
                <div class="right-arrow">></div> <!-- right arrow -->
                <div class="single-post-small-title"></div> <!-- post small title -->
            </div> <!-- small category and post title -->

            <div class="single-post-img">
                <img id="single-post-image" alt="">
            </div><!-- post image -->

            <div class="single-post-title"></div><!-- post title -->

            <div class="single-post-date-time">
                <div class="single-post-date-wrapper">
                    <div class="date-icon"><img src="client/calendar-icon" alt=""></div>
                    <div id="posted-date" class="single-post-date"></div>
                </div>
                <div class="single-post-comments">
                    <div class="single-post-comm-icon"><img src="client/comment-icon" alt=""></div>
                    <div id="small-comments" class="single-post-comm-num"></div>
                </div>
            </div>

            <div id="post-text" class="single-post-text"></div><!-- post text -->

            <script type="text/javascript">
                $(document).ready(function(){
                    var url = document.location.href,
                    params = url.split('?')[1].split('&'),
                    data = {}, tmp;
                    for (var i = 0, l = params.length; i < l; i++) {
                        tmp = params[i].split('=');
                        data[tmp[0]] = tmp[1];
                    }

                    const postId = data.postId;
                    console.log(postId);

                    $.ajax({
                        url: 'users/post?postId=' + postId,
                        success: function(data){
                            console.log(data);
                            const post = data.singlePost;

                            $('.category-post-title').append(post[0].category).attr({ 'href':'category?catId=' + post[0].category_id });
                            $('.single-post-small-title').append(post[0].title);
                            $('#single-post-image').attr({ 'src':'admin/post-image?image=' + post[0].image });
                            $('.single-post-title').append(post[0].title);
                            $('#posted-date').append(post[0].date_posted);
                            $('#post-text').append(post[0].text);
                        }
                    })

                })
            </script>

            <div class="share-buttons">
                <span class="facebook-share" data-js="facebook-share"><img src="client/facebook-icon"><span>Share</span></span>
                <span class="twitter-share" data-js="twitter-share"><img src="client/twitter-icon"><span>Share</span></span>
            </div><!-- share buttons -->


            <div class="single-posts-comments-section">
                <div class="all-comments-numb-label"><span id="comments_numb"></span></div> <!-- all comments numb -->
                <br>
                <div class="all-comments"></div> <!-- all comments -->
                <br>
                <div class="leave-comment-label"><span>ОСТАВИ КОМЕНТАР</span></div>
                <br>
                <div class="leave-comment-form">
                    <div class="name-input-wrapper">
                        <input id="comment-user-name" type="text" placeholder="Име">
                    </div>
                    <br>
                    <div class="name-input-wrapper">
                        <textarea name="" id="comment" cols="30" rows="10" placeholder="Коментар"></textarea>
                    </div>
                </div><!-- leave comment form -->

                <div class="leave-comment-btn">Остави коментар</div><!-- leave comment btn -->
            </div> <!-- comments section -->

            <script type="text/javascript">
                $(document).ready(function(){
                    var url = document.location.href,
                    params = url.split('?')[1].split('&'),
                    data = {}, tmp;
                    for (var i = 0, l = params.length; i < l; i++) {
                        tmp = params[i].split('=');
                        data[tmp[0]] = tmp[1];
                    }

                    const postId = data.postId;

                    $('.leave-comment-btn').click(function(event){
                        const commentUserName = $('#comment-user-name').val();
                        const commentText = $('#comment').val();

                        $.ajax({
                            url: 'users/add-comment?postId=' + postId,
                            method: 'post',
                            data: {
                                name: commentUserName,
                                text: commentText
                            },
                            success: function(data){
                                console.log(data);
                            }, error: function(error){
                                console.log(error);
                            }
                        })
                    })

                    $.ajax({
                        url: 'users/post-comments?postId=' + postId,
                        success: function(data){
                            console.log(data);
                            const comments = data.postComments;
                            
                            const commentsNumb = comments.length;
                            if(commentsNumb == 1){
                                $('#comments_numb').append(commentsNumb + ' ' + 'КОМЕНТАР');
                                $('#small-comments').append(commentsNumb + ' ' + 'коментар');
                            } else {
                                $('#comments_numb').append(commentsNumb + ' ' + 'КОМЕНТАРИ');
                                $('#small-comments').append(commentsNumb + ' ' + 'коментари');
                            }

                            var i = 0;
                            while(i < comments.length){
                                const commentBox = $('<div>').addClass('comment-box');
                                    const commentUserName = $('<div>').addClass('comment-user-name');
                                        const personIconDiv = $('<div>').addClass('person-icon');
                                            const personIcon = $('<img>').attr({ 'src' : 'client/user-icon' });
                                        personIconDiv.append(personIcon);
                                            const personName = $('<div>').addClass('person-name').append(comments[i].user_name);
                                        commentUserName.append(personIconDiv);
                                        commentUserName.append(personName);
                                            const commentDate = $('<div>').addClass('comment-date');
                                                const dateIconDiv = $('<div>').addClass('date-icon');
                                                    const dateIcon = $('<img>').attr({ 'src':'client/calendar-icon' });
                                                dateIconDiv.append(dateIcon);
                                                const date = $('<div>').addClass('date').append(comments[i].date_posted);
                                            commentDate.append(dateIconDiv);
                                            commentDate.append(date);
                                        commentUserName.append(commentDate);
                                commentBox.append(commentUserName);
                                    const commentText = $('<div>').addClass('comment-text').append(comments[i].text);
                                commentBox.append(commentText);

                                $('.all-comments').append(commentBox);
                                            
                                i++;
                            }
                        }
                    })
                })
            </script>


            <div class="category-post">
                <div class="cat-title">
                   <a class="title-cat-link" href="#">Македонија</a> 
                </div> <!-- cat title -->

                <script type="text/javascript">
                    $(document).ready(function(){
                        $.ajax({
                            url: 'users/mk-posts',
                            success: function(data){
                                // console.log(data);
                                const catPosts = data.categoryPosts;

                                var i = 0;
                                while(i < catPosts.length){
                                    const singlePostCat = $('<div>').addClass('single-post-cat');
                                        const postImageDiv = $('<div>').addClass('post-image');
                                            const seeMoreDiv = $('<a>').addClass('see-more').attr({ 'href':'post?postId=' + catPosts[i].ID });
                                                const seeMoreBtn = $('<div>').addClass('see-more-btn').append('see more').attr({ 'id': catPosts[i].ID });
                                            seeMoreDiv.append(seeMoreBtn);
                                        postImageDiv.append(seeMoreDiv);
                                            const postImage = $('<img>').attr({ 'src':'admin/post-image?image=' + catPosts[i].image });
                                        postImageDiv.append(postImage);
                                    singlePostCat.append(postImageDiv);

                                        const postOtherInfo = $('<div>').addClass('post-other-info');
                                            const postTitle = $('<div>').addClass('post-title').attr({ 'id': catPosts[i].ID });
                                                const boldedText = $('<b>').append(catPosts[i].title);
                                            postTitle.append(boldedText);
                                        postOtherInfo.append(postTitle);

                                            const todayDate = $('<div>').addClass('today-date');
                                                const clockIconDiv = $('<div>').addClass('clock-icon');
                                                    const clockIcon = $('<img>').attr({ 'src':'client/clock-icon' });
                                                clockIconDiv.append(clockIcon);
                                            todayDate.append(clockIconDiv);
                                                const date = $('<div>').addClass('date').append(catPosts[i].date_posted);
                                            todayDate.append(date);
                                        postOtherInfo.append(todayDate);
                                    singlePostCat.append(postOtherInfo);

                                    $('#mk-posts').append(singlePostCat);
                                    i++;
                                }
                            }
                        })
                    })
                </script>

                <div id="mk-posts" class="posts-wrapper"></div><!-- posts wrapper -->
            </div><!-- category post-->

            <div class="category-post">
                <div class="cat-title">
                    <a class="title-cat-link" href="#">Свет</a> 
                 </div> <!-- cat title -->

                 <script type="text/javascript">
                    $(document).ready(function(){
                        $.ajax({
                            url: 'users/w-posts',
                            success: function(data){
                                // console.log(data);
                                const catPosts = data.categoryPosts;

                                var i = 0;
                                while(i < catPosts.length){
                                    const singlePostCat = $('<div>').addClass('single-post-cat');
                                        const postImageDiv = $('<div>').addClass('post-image');
                                            const seeMoreDiv = $('<a>').addClass('see-more').attr({ 'href':'post?postId=' + catPosts[i].ID });
                                                const seeMoreBtn = $('<div>').addClass('see-more-btn').append('see more').attr({ 'id': catPosts[i].ID });
                                            seeMoreDiv.append(seeMoreBtn);
                                        postImageDiv.append(seeMoreDiv);
                                            const postImage = $('<img>').attr({ 'src':'admin/post-image?image=' + catPosts[i].image });
                                        postImageDiv.append(postImage);
                                    singlePostCat.append(postImageDiv);

                                        const postOtherInfo = $('<div>').addClass('post-other-info');
                                            const postTitle = $('<div>').addClass('post-title').attr({ 'id': catPosts[i].ID });
                                                const boldedText = $('<b>').append(catPosts[i].title);
                                            postTitle.append(boldedText);
                                        postOtherInfo.append(postTitle);

                                            const todayDate = $('<div>').addClass('today-date');
                                                const clockIconDiv = $('<div>').addClass('clock-icon');
                                                    const clockIcon = $('<img>').attr({ 'src':'client/clock-icon' });
                                                clockIconDiv.append(clockIcon);
                                            todayDate.append(clockIconDiv);
                                                const date = $('<div>').addClass('date').append(catPosts[i].date_posted);
                                            todayDate.append(date);
                                        postOtherInfo.append(todayDate);
                                    singlePostCat.append(postOtherInfo);

                                    $('#w-posts').append(singlePostCat);
                                    i++;
                                }
                            }
                        })
                    })
                </script>

                <div id="w-posts" class="posts-wrapper"></div> <!-- posts wrapper -->
            </div><!-- category post-->

            <div class="category-post">
                <div class="cat-title">
                    <a class="title-cat-link" href="#">Спорт</a> 
                </div> <!-- cat title -->

                <script type="text/javascript">
                    $(document).ready(function(){
                        $.ajax({
                            url: 'users/s-posts',
                            success: function(data){
                                // console.log(data);
                                const catPosts = data.categoryPosts;

                                var i = 0;
                                while(i < catPosts.length){
                                    const singlePostCat = $('<div>').addClass('single-post-cat');
                                        const postImageDiv = $('<div>').addClass('post-image');
                                            const seeMoreDiv = $('<a>').addClass('see-more').attr({ 'href':'post?postId=' + catPosts[i].ID });
                                                const seeMoreBtn = $('<div>').addClass('see-more-btn').append('see more').attr({ 'id': catPosts[i].ID });
                                            seeMoreDiv.append(seeMoreBtn);
                                        postImageDiv.append(seeMoreDiv);
                                            const postImage = $('<img>').attr({ 'src':'admin/post-image?image=' + catPosts[i].image });
                                        postImageDiv.append(postImage);
                                    singlePostCat.append(postImageDiv);

                                        const postOtherInfo = $('<div>').addClass('post-other-info');
                                            const postTitle = $('<div>').addClass('post-title').attr({ 'id': catPosts[i].ID });
                                                const boldedText = $('<b>').append(catPosts[i].title);
                                            postTitle.append(boldedText);
                                        postOtherInfo.append(postTitle);

                                            const todayDate = $('<div>').addClass('today-date');
                                                const clockIconDiv = $('<div>').addClass('clock-icon');
                                                    const clockIcon = $('<img>').attr({ 'src':'client/clock-icon' });
                                                clockIconDiv.append(clockIcon);
                                            todayDate.append(clockIconDiv);
                                                const date = $('<div>').addClass('date').append(catPosts[i].date_posted);
                                            todayDate.append(date);
                                        postOtherInfo.append(todayDate);
                                    singlePostCat.append(postOtherInfo);

                                    $('#s-posts').append(singlePostCat);
                                    i++;
                                }
                            }
                        })
                    })
                </script>

                <div id="s-posts" class="posts-wrapper"></div><!-- posts wrapper -->
            </div><!-- category post-->
        </div><!-- middle -->

        <script type="text/javascript">
            $(document).ready(function(){
                var facebookShare = document.querySelector('[data-js="facebook-share"]');
                facebookShare.onclick = function(e) {
                e.preventDefault();
                var facebookWindow = window.open('https://www.facebook.com/sharer/sharer.php?u=' + document.URL, 'facebook-popup', 'height=350,width=600');
                if(facebookWindow.focus) { facebookWindow.focus(); }
                    return false;
                }

                var twitterShare = document.querySelector('[data-js="twitter-share"]');
                twitterShare.onclick = function(e) {
                e.preventDefault();
                var twitterWindow = window.open('https://twitter.com/share?url=' + document.URL, 'twitter-popup', 'height=350,width=600');
                if(twitterWindow.focus) { twitterWindow.focus(); }
                    return false;
                }
            })
        </script>

        <div class="left">
            <div id="latest_posts" class="latest-news">
                <div class="latest-label">
                    Последни
                </div><!-- latest label-->

                <script type="text/javascript">
                    $(document).ready(function(){
                        $.ajax({
                            url: 'users/last-posts',
                            success: function(data){
                                // console.log(data);
                                const lastPosts = data.lastPosts;

                                var i = 0;
                                while(i < lastPosts.length){
                                    const singlePostDiv = $('<div>').addClass('single-post');
                                        const latestCategory = $('<a>').addClass('latest-category').append(lastPosts[i].category).attr({ 'href': 'category?catId=' + lastPosts[i].category_id,  });
                                    singlePostDiv.append(latestCategory);
                                        const postTitleLink = $('<a>').addClass('post-title-link').attr({ 'href':'post?postId=' + lastPosts[i].ID });
                                            const postTitle = $('<div>').addClass('post-title');
                                                const boldedText = $('<b>').append(lastPosts[i].title);
                                            postTitle.append(boldedText);
                                        postTitleLink.append(postTitle);
                                    singlePostDiv.append(postTitleLink);
                                        const todayDate = $('<div>').addClass('today-date');
                                            const clockIconDiv = $('<div>').addClass('clock-icon');
                                                const clockIcon = $('<img>').attr({ 'src':'client/clock-icon' });
                                            clockIconDiv.append(clockIcon);
                                        todayDate.append(clockIconDiv);
                                            const date = $('<div>').addClass('date').append(lastPosts[i].time_posted + ',' + ' ' + lastPosts[i].date_posted);
                                        todayDate.append(date);
                                    singlePostDiv.append(todayDate);

                                    $('#latest_posts').append(singlePostDiv);
                                    i++;
                                }
                            }
                        })
                    })
                </script>
            </div><!-- latest -->

            <div id="magasine-posts" class="latest-news">
                <div class="latest-label">
                    Магазин
                </div><!-- latest label-->

                <script tyle="text/javascript">
                    $(document).ready(function(){
                        $.ajax({
                            url: 'users/magasine-posts',
                            success: function(data){
                                console.log(data);
                                const magasinePosts = data.magasinePosts;

                                var i = 0;
                                while(i < magasinePosts.length){
                                    const singlePost = $('<div>').addClass('single-post');
                                        const postImageDiv = $('<div>').addClass('post-image');
                                            const seeMoreDiv = $('<a>').addClass('see-more').attr({ 'href':'post?postId=' + magasinePosts[i].ID });
                                                const seeMoreBtn = $('<div>').addClass('see-more-btn').append('see more').attr({ 'id': magasinePosts[i].ID });
                                            seeMoreDiv.append(seeMoreBtn);
                                        postImageDiv.append(seeMoreDiv);
                                            const postImage = $('<img>').attr({ 'src':'admin/post-image?image=' + magasinePosts[i].image });
                                        postImageDiv.append(postImage);
                                    singlePost.append(postImageDiv);

                                        const postTitle = $('<div>').addClass('post-title').attr({ 'id': magasinePosts[i].ID });
                                            const boldedText = $('<b>').append(magasinePosts[i].title);
                                        postTitle.append(boldedText);
                                    singlePost.append(postTitle);

                                    $('#magasine-posts').append(singlePost);
                                    i++;
                                }
                            }
                        })
                    })
                </script>
            </div><!-- latest -->
        </div><!-- left -->
        


        <div class="right">
            <div id="top-news" class="latest-news">
                <div class="latest-label">
                    Топ вести
                </div><!-- latest label-->

                <script type="text/javascript">
                    $(document).ready(function(){
                        $.ajax({
                            url: 'users/last-posts',
                            success: function(data){
                                // console.log(data);
                                const lastPosts = data.lastPosts;

                                var i = 0;
                                while(i < lastPosts.length){
                                    const singlePostDiv = $('<div>').addClass('single-post');
                                        const latestCategory = $('<a>').addClass('latest-category').append(lastPosts[i].category).attr({ 'id': lastPosts[i].category_id, 'href':'#' });
                                    singlePostDiv.append(latestCategory);
                                        const postTitleLink = $('<a>').addClass('post-title-link').attr({ 'href':'#', 'id': lastPosts[i].ID });
                                            const postTitle = $('<div>').addClass('post-title');
                                                const boldedText = $('<b>').append(lastPosts[i].title);
                                            postTitle.append(boldedText);
                                        postTitleLink.append(postTitle);
                                    singlePostDiv.append(postTitleLink);
                                        const todayDate = $('<div>').addClass('today-date');
                                            const clockIconDiv = $('<div>').addClass('clock-icon');
                                                const clockIcon = $('<img>').attr({ 'src':'client/clock-icon' });
                                            clockIconDiv.append(clockIcon);
                                        todayDate.append(clockIconDiv);
                                            const date = $('<div>').addClass('date').append(lastPosts[i].time_posted + ',' + ' ' + lastPosts[i].date_posted);
                                        todayDate.append(date);
                                    singlePostDiv.append(todayDate);

                                    $('#top-news').append(singlePostDiv);
                                    i++;
                                }
                            }
                        })
                    })
                </script>
            </div><!-- latest -->

            <div id="sport-small" class="latest-news space-arount">
                <div class="latest-label">
                    Спорт
                </div><!-- latest label-->

                <script type="text/javascript">
                    $(document).ready(function(){
                        $.ajax({
                            url: 'users/s-s-posts',
                            success: function(data){
                                // console.log(data);
                                const catPosts = data.categoryPosts;

                                var i = 0;
                                while(i < catPosts.length){
                                    const singlePostSmall = $('<div>').addClass('single-post-small');
                                        const postSmallImgDiv = $('<div>').addClass('post-small-image');
                                            const postImg = $('<img>').attr({ 'src':'admin/post-image?image=' + catPosts[i].image });
                                        postSmallImgDiv.append(postImg);
                                    singlePostSmall.append(postSmallImgDiv);
                                        
                                        const postSmallTitle = $('<div>').addClass('post-small-title').append(catPosts[i].title);
                                    singlePostSmall.append(postSmallTitle);

                                    $('#sport-small').append(singlePostSmall);
                                    i++;
                                }
                            }
                        })
                    })
                </script>
            </div><!-- latest -->
        </div><!-- right -->
    </div><!-- main -->

    <div class="footer">
        <div class="menu">
            <div class="footer-item">
                КОНТАКТ
            </div>
        </div> <!-- menu -->

        <div class="social-media-top-menu">
            <div class="social-menu-item"><img src="client/facebook-icon"></div>
            <div class="social-menu-item"><img src="client/twitter-icon"></div>
            <div class="social-menu-item"><img src="client/insta-icon"></div>
            <!-- <div class="social-menu-item"><img src="client/phone-icon"></div> -->
        </div><!-- social media top menu -->

        <div class="copyright">
            © Copyright 2020 newsmk.mk
        </div> <!-- copyright -->
    </div> <!-- footer -->

    <script>
        function startTime() {
            var today = new Date();
            var h = today.getHours();
            var m = today.getMinutes();
            var s = today.getSeconds();
            m = checkTime(m);
            s = checkTime(s);
            document.querySelector('.clock').innerHTML = h + ":" + m + ":" + s;
            var t = setTimeout(startTime, 500);
        }
        function checkTime(i) {
            if (i < 10) {i = "0" + i};
            return i;
        }
    </script>
</body>
</html>